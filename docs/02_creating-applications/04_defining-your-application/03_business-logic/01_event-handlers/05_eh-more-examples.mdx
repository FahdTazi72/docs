---
title: 'More examples'
sidebar_label: 'More examples'
sidebar_position: 5
id: eh-more-examples
---

[Introduction](/creating-applications/defining-your-application/business-logic/event-handlers/)  | [Where to define](/creating-applications/defining-your-application/business-logic/event-handlers/event-handler-define/) | [Basics](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/) |  [Advanced](/creating-applications/defining-your-application/business-logic/event-handlers/eh-advanced-technical-details/) | [More examples](/creating-applications/defining-your-application/business-logic/event-handlers/eh-more-examples/) | [Configuring runtime](/creating-applications/defining-your-application/business-logic/event-handlers/eh-configuring-runtime/) | [Testing](/creating-applications/defining-your-application/business-logic/event-handlers/eh-testing/)



There is a nice simple example of some logic being added to an Event Handler in our [tutorial](/tutorials/building-an-application/add-event-handler/).

Below we have some other examples of different ways to use an Event Handler.
&nbsp;  
&nbsp;  
&nbsp;  

The example below is a simple Event Handler
to validate input and insert a record in the database. There is an [`onValidate`](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#onvalidate)  block that defines the validation and an [`onCommit`](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#oncommit) block that specifies the action that is to be taken.
```kotlin
   eventHandler<Company>(name = "COMPANY_INSERT") {
        onValidate { event ->
            val company = event.details
            require(company.companyName != "MY_COMPANY") {
                "We don't accept your company"
            }
            ack()
        }
        onCommit { event ->
            val company = event.details
            val result = entityDb.insert(company)
            ack(listOf(mapOf("COMPANY_ID" to result.record.companyId)))
        }
    }
```
&nbsp;  
&nbsp;  

This next snippet is an example of how to reuse data between 
[onValidate](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#onvalidate) 
and [onCommit](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#oncommit) using a `contextEventHandler`. In the `onValidate` block we check to see if a trade exists in the database, and we pass it as _context_ to the `onCommit` block so we don't have to do another database lookup.

```kotlin
    contextEventHandler<TradeAlertAck, Trade>(name = "TRADE_ALERT_ACK") {
        onValidate { event ->
            val tradeAlert = event.details
            val tradeId = tradeAlert.tradeId
            val existingTrade = entityDb.get(tradeId)
            require(existingTrade != null) {
                "Failed to find trade with id: $tradeId"
            }
            validationAck(validationContext = existingTrade)
        }
        onCommit { event, context ->
            val tradeAlert = event.details
            val trade = context ?: throw IllegalStateException("Expected trade with id ${tradeAlert.tradeId} as context but it is missing")
            trade.acknowledged = true
            entityDb.modify(trade)
            ack()
        }
    }
```
&nbsp;  
&nbsp;

This is an example of how to use [`onException`](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#onexception)
in an Event Handler.
```kotlin
    eventHandler<Company>(name = "COMPANY_INSERT") {
        onException { event, throwable ->
            val company = event.details
            nack("Error when trying to insert company with id ${company.companyId}! ${throwable.message}")
        }

        onCommit { event ->
            val company = event.details
            val result = entityDb.insert(company)
            ack(listOf(mapOf("VALUE" to result.record.companyId)))
        }
    }
```
&nbsp;
&nbsp;

This is an example of how to add [authorisation](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#permissioning-and-permissioncodes)
to an Event Handler.

```kotlin
    eventHandler<Company>(name = "AUTH_COMPANY_INSERT") {
        permissioning {
            auth(mapName = "COMPANY"){
                COMPANY.COMPANY_NAME
            }
        }

        onCommit { event ->
            val company = event.details
            val result = entityDb.insert(company)
            ack(listOf(mapOf("VALUE" to result.record.companyId)))
        }
    }
```
&nbsp;  
&nbsp;  

And now an example with [fixed permissions](/creating-applications/defining-your-application/business-logic/event-handlers/eh-technical-details/#permissioning-and-permissioncodes).

```kotlin
    eventHandler<Company>(name = "AUTH_COMPANY_INSERT") {
        permissionCodes = listOf("INSERT_TRADE")
        onCommit { event ->
            val company = event.details
            val result = entityDb.insert(company)
            ack(listOf(mapOf("VALUE" to result.record.companyId)))
        }
    }
```
&nbsp;  
&nbsp;  

Below is an example of how to make an Event Handler [transactional](/creating-applications/defining-your-application/business-logic/event-handlers/eh-advanced-technical-details/#acid-guaranteed).

```kotlin
    eventHandler<Company>(name = "COMPANY_INSERT", transactional = true) {
        onValidate {
            ack()
        }
        onCommit { event ->
            val company = event.details
            entityDb.insert(company)
            ack(listOf(mapOf("VALUE" to "SUCCESS!")))
        }
    }
```
&nbsp;  
&nbsp;  

The example below is a simple Event Handler that [requires approval](/creating-applications/defining-your-application/business-logic/event-handlers/eh-advanced-technical-details/#pending-approvals).
```kotlin

eventHandler {
    eventHandler<Company> {
        requiresPendingApproval = true
        onCommit { event ->
            val company = event.details
            // custom code block..
            ack()
        }
    }
}
```
