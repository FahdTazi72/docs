---
title: 'Document Generation - Templates'
sidebar_label: 'Templates'
id: templates
keywords: [packaged business capabilities, pbc]
tags:
  - packaged business capabilities
  - pbc
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import {gsfVersion} from '../../../../src/versioning/versions.js'

## Introduction
A common use case for document management applications is the ability for users to generate files based on a certain dataset.
This can be done easily using the Document Generator with a seed template.

The Document Generator enables you to generate documents based on a pre-uploaded template to FILE_STORAGE (see Document Management for more information on uploading/downloading files).
Alongside the template, if any assets are required (e.g. images, css files etc.) these must also be uploaded to FILE_STORAGE as well as the TEMPLATE_ASSET table in order to map those assets to the corresponding template.

It can generate the following:
- TXT content/file based on a TXT template
- HTML content/file based on an HTML template
- PDF file based on an HTML template

## Interacting with the Document Generator

There are two ways of interacting:
- `generateContent` generates the raw content of the file (not supported for PDF files). This is returned alongside any corresponding AssetIds.
- `generateAndStore` generates a file based on the template provided. The file is uploaded to FILE_STORAGE and the corresponding FileStorageID is returned.

### DocumentContentConfiguration

The `generateContent` method takes in an object with the following parameters:
- `templateId` is the FileStorageId for the template you want to generate the document from.
- `userName` is the username of the user generating the document.
- `data` is the map of data to be substituted in the template (the key in the map must match the placeholder in the template file!).
- `deleteOnExit` controls whether to delete the working directory once the result has been produced (default: true).
- `workingDirectory` is the optional path to a working directory (default: a temporary directory is created in the system).

For example:
```kotlin
DocumentContentConfiguration(
    fileStorageId = "FILE_0001",
    userName = "JohnDoe",
    data = mapOf("trades" to Trade(price = BigDecimal.ONE, quantity = 1, counterparty = "counterparty", side = Side.BUY, account = "account")))
```

### DocumentContentResult

The `generateContent` method returns an object with the following parameters:
- `rawContent` is the content of the resulting document generation.
- `assetIds` is a list of corresponding asset ids to the provided template.

For example:
```kotlin
DocumentContentResult(
    rawContent = "<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"UTF-8\">...",
    assetIds = listOf("ASSET_001", "ASSET_002")
)
```

### DocumentStorageConfiguration

The `generateAndStore` method takes in an object with the following parameters:
- everything in **DocumentContentConfiguration**.
- `fileName` is the file name for the document you would like to generate.

For example:
```kotlin
DocumentStorageConfiguration(
    fileStorageId = "FILE_0001",
    fileName = "trades-pdf-gen.pdf",
    userName = "JohnDoe",
    data = mapOf("trades" to Trade(price = BigDecimal.ONE, quantity = 1, counterparty = "counterparty", side = Side.BUY, account = "account")),
    deleteOnExit = false,
    workingDirectory = "tmp/provided_dir")
```

### DocumentStorageResult

The `generateAndStore` method returns an object with the following parameters:
- `fileStorageId` is the FileStorageId of the generated file.

For example:
```kotlin
DocumentStorageResult(
    fileStorageId = "FILE_0002"
)
```

## Template types

### HTML templates

When an HTML template is provided, [Thymeleaf](https://www.thymeleaf.org/documentation.html) is used to output the processed text.

Thymeleaf can process complex data objects, so the HTML template can include loops as shown in the example below. This component can be part of an HTML template file:

```html
<tbody>
    <tr th:each="trade : ${trades}">
        <td th:text="${trade.price}">1.00</td>
        <td th:text="${trade.quantity}">1000</td>
        <td th:text="${trade.counterparty}">Counterparty1</td>
        <td th:text="${trade.side}">BUY</td>
        <td th:text="${trade.account}">Account1</td>
    </tr>
</tbody>
```
Users can then provide their own maps for what trade data they would like to be displayed, and generate a file. 

If the user wants to receive the generated HTML content with the data replaced in order to send an email with this body, the data object could be:

```kotlin
val trade = Trade(price = BigDecimal.ONE, quantity = 1, counterparty = "counterparty", side = Side.BUY, account = "account")
val data = mapOf("trades" to listOf(trade))
```

### TXT templates

When a TXT template is provided, the TXT template engine uses a simple substitution syntax. Thus, each field must be added individually.
The TXT engine automatically gets system definition keys as well as any environment variables as part of its data context.

For example, a TXT template can include the following:

```text
Price: {{PRICE}}
Quantity: {{QUANTITY}}
Counterparty: {{COUNTERPARTY}}
Side: {{SIDE}}
Account: {{ACCOUNT}}
```

The corresponding data object would be:
```kotlin
val data = mapOf("PRICE" to 1, "QUANTITY" to 5, "COUNTERPARTY" to "counterparty_id", "SIDE" to Side.BUY, "ACCOUNT" to "account_id")
```

## Dependencies

To inject the DocumentGenerator, set up the following dependency in your project.

Version: {gsfVersion}

<Tabs defaultValue="gradle" values={[{ label: 'Gradle', value: 'gradle', }, { label: 'Maven', value: 'maven', }]}>
    <TabItem value="gradle">

        ```kotlin
        implementation("global.genesis:file-server-templates:$version")
        ```

    </TabItem>
    <TabItem value="maven">

        ```xml
        <dependency>
            <groupId>global.genesis</groupId>
            <artifactId>file-server-templates</artifactId>
            <version>$version</version>
        </dependency>
        ```
    </TabItem>
</Tabs>

## Examples

### Inject a Document Generator in an Event Handler

This example injects a Document Generator in an [Event Handler](../../../../server/event-handler/basics) file. It generates and stores a pdf file for use with an email. 

```kotlin
val documentGenerator = inject<DocumentGenerator>()

eventHandler<PdfGeneratorData>(name = "GENERATE_PDF_EMAIL") {
        onValidate {
            ack()
        }
        onCommit { event ->
            val details = event.details
            val trade = entityDb.get(Trade.byId(details.tradeId))
            val tradeMap : Map<String, Any> = mapOf(
                "trades" to listOf(trade)
            )

            val documentStorageResult =
                documentGenerator.generateAndStore(
                    DocumentStorageConfiguration(
                        fileStorageId = "FILE_0001",
                        fileName = "trades-pdf-gen.pdf",
                        userName = "JohnDoe",
                        data = tradeMap,
                        deleteOnExit = false,
                        workingDirectory = "tmp/provided_dir")
                )

            // custom code block ...

            ack()
        }
    }
```

### Inject Document Generator inside a module constructor

This example injects Document Generator inside a module constructor. It generates content only.
```kotlin
@Module
class GeneratePdf @Inject constructor(
    val entityDb: AsyncEntityDb,
    private val documentGenerator: DocumentGenerator
) {

    val trades = entityDb.getBulk(TRADE).toList()
            val tradeMap : Map<String, Any> = mapOf(
                "trades" to listOf(trades)
            )

    val documentContentResult =
                documentGenerator.generateContent(
                    DocumentContentConfiguration(
                        fileStorageId = "FILE_0001",
                        userName = "JohnDoe",
                        data = tradeMap,
                        deleteOnExit = false,
                        workingDirectory = "tmp/provided_dir")
                )
    // custom code block ...
}
```
